---
title: "Sliders"
engine: knitr
theme: sandstone
format: 
  live-html:
    page-layout: custom
execute:
  echo: false
---

{{< include ./_extensions/r-wasm/live/_knitr.qmd >}}

```{r, load}
#| include: false
library(shiny)
library(bslib)
library(ggplot2)
library(ggtext)
library(shinythemes)
library(thematic)
library(tidyverse)
library(httr)
library(htmltools)
library(glue)


```

```{ojs}
//| echo: false
//| panel: sidebar

import {FileAttachment} from "observablehq:stdlib";
import {vl} from "@vega/vega-lite-api"
import {aq, op} from "@uwdata/arquero"

vg = require('vega-lite')

imageURL_invert = FileAttachment("/data/invert 2.png").url()
imageURL_peri = FileAttachment("/data/periphyton.png").url()
imageURL_invert_div = FileAttachment("/data/invert_div.png").url()
imageURL_par_len = FileAttachment("/data/par_len.png").url()

viewof wetted = Inputs.range(
  [0, 10], 
  {value: 5, step: 0.1, label: "Wetted width ():"}
);
viewof substrate = Inputs.range(
  [0, 10], 
  {value: 5, step: 0.1, label: "Substrate size ():"}
);
viewof percent = Inputs.range(
  [0, 20], 
  {value: 10, step: 0.1, label: "Percent lake ():"}
);
```

```{ojs}
//| echo: false
//| panel: fill


function myFunction(wetted, substrate, percent) {
  return aq.table({
  'wetted': [wetted, wetted, wetted, wetted],
  'substrate': [substrate, substrate, substrate, substrate],
  'percent': [percent, percent, percent, percent],
  'response_type': ["Invertebrate biomass ()", "Periphyton biomass ()", "Invertebrate diversity", "Par length (cm)"],
  'response_predict': [0.83-0.095*wetted+0.03*substrate, 0.44+0.026*wetted+0.32*percent, 0.7+0.0016*substrate, 0.1+0.06*wetted],
  'image_path': [imageURL_invert, imageURL_peri, imageURL_invert_div, imageURL_par_len]
})
}

predictions_ps = myFunction(wetted, substrate, percent)

images = aq.table({
  'response_type': ["invert", "invert_d", "par", "peri"],
  'image_path': [imageURL_invert, imageURL_invert_div, imageURL_par_len, imageURL_peri]
})

Plot.plot({
  width: Math.max(width, 550),
  height: Math.floor(0.4 * width),
  marginLeft: 0,
  marginRight: 0,
  colour: {legend: false},
  y: {domain: [0,8], axis: null},
  x: {label: null},
  marks:[
    Plot.axisX({fontSize: 18}),
    Plot.barY(predictions_ps,
     {x: "response_type",
     y: "response_predict",
     fill: "response_type"}),
    Plot.text(predictions_ps, {x: "response_type", y: "response_predict", text: "response_predict", dy: -7, lineAnchor: "bottom", fontSize: 25}),
   ]
})

Plot.plot({
  width: Math.max(width, 550),
  height: Math.floor(0.1 * width),
  marginLeft: 0,
  marginRight: 0,
  colour: {legend: false},
  y: {domain: [0,0], axis: null},
  x: {label: "Response type", axis: null, fontSize: 22},
  marks:[
    Plot.image(images, 
      {x: "response_type",
      y: [0, 0, 0, 0],
      src: "image_path",
      width: 150,
      axis: null
      })
   ]
})
```
